<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/images/icons/ccapi.png">
    <title>Custom Controls API Docs</title>
    <script type="module" src="ui.js" defer></script>
    <link href="./output.css" rel="stylesheet">
</head>

<body class="bg-slate-800 text-white">
<div id="sidebar-overlay" class="fixed inset-0 bg-black/20 z-40 hidden transition-opacity duration-300"></div>

<div class="lg:flex min-h-screen">
    <aside class="select-none bg-slate-900 flex-col fixed top-0 md:left-0 left-1/2 md:h-full w-1/2 md:w-72 p-4 transform -translate-x-full xl:translate-x-0 xl:flex transition-transform duration-300 z-50 rounded-b-2xl md:rounded-none">
        <div class="md:px-0 px-4 h-16 lg:border-b border-slate-600 flex justify-center items-center font-bold bg-slate-900 flex-shrink-0 relative">
            <a href="https://github.com/Starexify/CustomControlsAPI" target="_blank"><img src="assets/images/icons/ccapi.png" class="w-22 mb-1 h-auto"></a>
            <span class="hidden xl:block text-center">Custom Controls API Documentation</span>
            <button id="sidebar-close" class="xl:hidden p-1 text-gray-400 hover:text-white absolute top-2 right-2">
                <svg class="size-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <div class="flex-1 overflow-y-auto mt-2 min-h-0">
            <ul id="sidebar" class="space-y-2 px-2 pb-4"></ul>
        </div>

        <div id="hub-link" class="mt-auto pt-4 border-t border-slate-600 flex-shrink-0"></div>
    </aside>

    <div class="flex-1 flex flex-col xl:ml-64 min-h-screen">
        <header class="text-white shadow-lg border-b border-b-slate-900/50 h-16 flex items-center justify-between px-6 lg:px-12 flex-shrink-0">
            <h1 class="xl:hidden text-xl font-bold select-none">Custom Controls API Docs</h1>
            <div></div>
            <div class="flex items-center relative">
                <a href="https://gamebanana.com/mods/626069" target="_blank" class="text-gray-500 hover:text-gray-900 dark:hover:text-white p-2">
                    <svg class="size-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M14.249 0v3h1.5V1.5h1.505V3h-1.505v4.5h1.5v-3h3.002V3h-1.505V0Zm6.002 4.498v1.5h1.5V4.501Zm1.5 1.5v10.503h1.5V5.998Zm0 10.503h-1.5V19.5h1.5zm-1.5 2.998h-1.505v1.5h1.5zm-1.5 1.5h-3.002v1.5h3.001zm-3.002 1.5H6.75V24h9zm-8.999 0V21h-3v1.5zm-3-1.5v-1.497H2.248v1.5zm-1.501-1.497v-2.997H9.75v-1.5H.748v4.497zm7.502-4.497h2.997v-1.5H9.751Zm2.997-1.5h1.5v-1.501h-1.5zm1.5-1.501h1.501V7.506h-1.5z"/>
                    </svg>
                    <span class="sr-only">GameBanana link</span>
                </a>
                <a href="https://github.com/Starexify/CustomControlsAPI" target="_blank" class="text-gray-500 hover:text-gray-900 dark:hover:text-white p-2 mr-8">
                    <svg class="size-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                         viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                              d="M10 .333A9.911 9.911 0 0 0 6.866 19.65c.5.092.678-.215.678-.477 0-.237-.01-1.017-.014-1.845-2.757.6-3.338-1.169-3.338-1.169a2.627 2.627 0 0 0-1.1-1.451c-.9-.615.07-.6.07-.6a2.084 2.084 0 0 1 1.518 1.021 2.11 2.11 0 0 0 2.884.823c.044-.503.268-.973.63-1.325-2.2-.25-4.516-1.1-4.516-4.9A3.832 3.832 0 0 1 4.7 7.068a3.56 3.56 0 0 1 .095-2.623s.832-.266 2.726 1.016a9.409 9.409 0 0 1 4.962 0c1.89-1.282 2.717-1.016 2.717-1.016.366.83.402 1.768.1 2.623a3.827 3.827 0 0 1 1.02 2.659c0 3.807-2.319 4.644-4.525 4.889a2.366 2.366 0 0 1 .673 1.834c0 1.326-.012 2.394-.012 2.72 0 .263.18.572.681.475A9.911 9.911 0 0 0 10 .333Z"
                              clip-rule="evenodd"/>
                    </svg>
                    <span class="sr-only">GitHub account</span>
                </a>
                <div id="sidebar-toggle-wrapper" class="xl:hidden fixed right-4 z-50 transition-transform transition-opacity duration-300 transform opacity-100 scale-100">
                    <button id="sidebar-toggle" class="p-2 text-gray-400 hover:text-white bg-slate-900/50 rounded-lg shadow-md">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="flex-1 md:py-8 lg:px-16 px-6 lg:pr-24 pt-8 pb-24 overflow-y-auto" id="content">
            <h1 class="text-3xl font-bold mb-4">Welcome to Custom Controls API Documentation</h1>
            <p>Select a topic from the sidebar to see its content.</p>
        </main>
    </div>
</div>

<script>
    const entries = [
        {
            id: 'getting-started',
            title: 'Getting Started',
            content: `<div class="flex flex-col gap-5">
<p class="text-3xl font-bold mb-2">Understanding Custom Controls API</p>

<p class="text-2xl font-bold -ml-2">What is Custom Controls API ?</p>
<p class="mb-4"><strong>CCAPI</strong><i> (short for Custom Controls API)</i> is an <strong>API</strong> for V-Slice mods, that allows modders to easily create and manage their own keybinds
inside the Controls page from the Options menu.</p>

<p class="text-2xl font-bold -ml-2">How does it work ?</p>
<p class="mb-4"><strong>CCAPI</strong> works by rebuilding the entire entries of the already existing Controls page while injecting the custom added ones at the same time when opening the Options state.</p>
</div>`,
            subsections: []
        },
        {
            id: 'setup',
            title: 'Setting up Custom Controls',
            content: `<div class="flex flex-col gap-5">
<p class="text-2xl font-bold -ml-2">Installation</p>
<p>
 To use <strong>CCAPI</strong> in your project, make sure it is installed as a <strong>mod</strong> inside your Friday Night Funkin' mods folder.
 Custom Controls API should be placed alongside your other mods so that it can add the custom controls for all mods.
</p>
<p>You can download CCAPI from:</p>
<ul class="list-disc ml-6 font-bold">
  <li><doc-link href="https://github.com/Starexify/CustomControlsAPI">Official GitHub Repo</doc-link></li>
  <li><doc-link href="https://gamebanana.com/mods/626069">Official GameBanana Page</doc-link></li>
</ul>
<p class="mb-4">After installing, verify that CCAPI loads correctly before attempting to register any control or keybind.</p>
</div>`,
            subsections: []
        },
        {
            id: 'classes',
            title: 'Classes',
            content: `<note-block text="Info">For more information about the classes check the source code from the <doc-link href="https://github.com/Starexify/CustomControlsAPI">GitHub Repo</doc-link></note-block>`,
            subsections: [
                {
                    id: 'controls-api',
                    title: 'ControlsAPI',
                    content: `<div class="flex flex-col gap-3">
<p>Controls API is the class for creating, modifying and managing custom control entries within the <strong>Controls Page</strong>.</p>
<p>It exposes the following API methods:</p>
<data-table class="mb-4"
    data-headers="Method,Parameters,Description"
    data-json='[
        ["registerKeybind()", "name, keys, ?header, ?inputTypes, ?index, ?spritePath", "Registers a new custom keybind entry."],
        ["registerHeader()", "name, ?index, ?centered, ?font", "Adds a new header section to the controls menu."],
        ["unregisterKeybind()", "name", "Removes a registered keybind by name."],
        ["unregisterHeader()", "name", "Removes a registered header by name."],
        ["readdBaseEntry()", "name, control", "Restores a previously removed base control entry."],
        ["removeBaseEntry()", "name, control, ?storeKeys, ?device", "Removes a base control entry and optionally stores its keybind data."]
    ]'>
</data-table>

<note-block class="block mt-2 mb-5">See <doc-link href="#input-types" target-off>Input Types</doc-link> for valid input type values.</note-block>
</div>`
                },
                {
                    id: 'controls-manager',
                    title: 'ControlsManager',
                    content: `<div class="flex flex-col gap-3">
<p><strong>ControlsManager</strong> is the runtime class responsible for processing input events from all registered <code-field>ControlSlot</code-field>s. It manages press and release queues, maps input keys to actions, and dispatches callbacks when specific input types are triggered. This class works alongside <doc-link href="#classes:controls-api" target-off>ControlsAPI</doc-link> to handle the input actions of the custom controls.</p>
<p>Automatically tracking pressed, just pressed, released, and just released states for each keybind, and provides a simple callback registration system for mods to fire logic when the key was pressed.</p>
<p>It exposes the following API methods:</p>
<data-table class="mb-4"
  data-headers="Method,Parameters,Description"
  data-json='[
          ["registerCallback()", "controlName, inputType, callback", "Registers a callback to be executed when a specific control and input type is triggered. The callback receives the pressed key code as an argument."]
  ]'>
</data-table>

<note-block class="block mt-2 mb-5">See <doc-link href="#input-types" target-off>Input Types</doc-link> for valid input type values.</note-block>
</div>`
                }
            ]
        },
        {
            id: 'input-types',
            title: 'Input Types',
            content: `<div class="flex flex-col gap-3">
<p class="mb-4">Input Types define the specific key state that triggers an action or callback in the <doc-link href="#classes:controls-manager" target-off>ControlsManager</doc-link>. These determine whether the event should occur when a key is first pressed, held, released, or just released.</p>

<p>Supported values:</p>
<data-table class="mb-4"
    data-headers="Constant,String Aliases,Description"
    data-json='[
        ["JUST_RELEASED (-1)", "justreleased, just_released", "Triggered once when a key is released after being pressed."],
        ["RELEASED (0)", "released", "Active while a key remains released (not pressed)."],
        ["PRESSED (1)", "pressed", "Active while a key is being held down."],
        ["JUST_PRESSED (2)", "justpressed, just_pressed", "Triggered once when a key is first pressed."]
    ]'>
</data-table>

<note-block class="block mt-2 mb-5">Input type strings are <strong>case-insensitive</strong>, so for example, both <code-field>justpressed</code-field> and <code-field>JUST_PRESSED</code-field> are valid.</note-block>
</div>`,
            subsections: []
        },
        {
            id: 'examples',
            title: 'Example API Usage',
            content: `<div class="flex flex-col gap-3">
<note-block class="block mt-2 mb-5">See <doc-link href="#input-types" target-off>Input Types</doc-link> for valid input type values.</note-block>

<h4 class="text-2xl font-bold -ml-2">Registering a Keybind</h4>
<p>Register a new custom keybind entry that can later be used in <doc-link href="#classes:controls-manager" target-off>ControlsManager</doc-link> callbacks.</p>
<code-block>
override public function onCreate(event:ScriptEvent) {
  ControlsAPI.instance.registerKeybind("Dodge", [32, 0], "NOTES", ["justPressed", "justReleased"]);
}
</code-block>

<h4 class="text-2xl font-bold -ml-2">Registering a Header</h4>
<p>Add a section header to group controls visually inside the Controls menu.</p>
<code-block>
override public function onCreate(event:ScriptEvent) {
  ControlsAPI.instance.registerHeader("Header", 1);
}
</code-block>

<h4 class="text-2xl font-bold -ml-2">Binding a Callback for a Custom Keybind</h4>
<p>Execute logic when a specific keybind is pressed using <doc-link href="#classes:controls-manager" target-off>ControlsManager</doc-link>.</p>
<code-block>
override public function onCreate(event:ScriptEvent) {
  ControlsManager.registerCallback("Dodge", InputsUtil.JUST_PRESSED, key -> {
    trace("Just pressed key: " + key);
  });
}
</code-block>
</div>`,
            subsections: []
        }
    ];

    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebarClose = document.getElementById('sidebar-close');
    const sidebarEl = document.querySelector('aside');
    const content = document.getElementById('content');
    const overlay = document.getElementById('sidebar-overlay');
    const sidebarToggleWrapper = document.getElementById('sidebar-toggle-wrapper');

    function openSidebar() {
        if (window.innerWidth < 768) sidebarEl.classList.remove('-translate-y-full');
        else sidebarEl.classList.remove('-translate-x-full');

        if (window.innerWidth < 1280) overlay.classList.remove('hidden');
        sidebarToggleWrapper.classList.remove('opacity-100', 'scale-100');
        sidebarToggleWrapper.classList.add('opacity-0', 'scale-75');
    }

    function closeSidebar() {
        if (window.innerWidth < 768) sidebarEl.classList.add('-translate-y-full');
        else sidebarEl.classList.add('-translate-x-full');

        overlay.classList.add('hidden');
        sidebarToggleWrapper.classList.remove('opacity-0', 'scale-75');
        sidebarToggleWrapper.classList.add('opacity-100', 'scale-100');
    }

    sidebarToggle.addEventListener('click', openSidebar);
    sidebarClose.addEventListener('click', closeSidebar);

    function initializeSidebar() {
        if (window.innerWidth >= 1280) { // xl breakpoint - desktop
            sidebarEl.classList.remove('-translate-x-full', '-translate-y-full');
            sidebarEl.classList.add('flex'); // ensure it's visible
        } else if (window.innerWidth >= 768) { // md to xl - tablet
            sidebarEl.classList.remove('-translate-y-full');
            sidebarEl.classList.add('-translate-x-full'); // start closed
        } else { // mobile - smaller than md
            sidebarEl.classList.remove('-translate-x-full');
            sidebarEl.classList.add('-translate-y-full'); // start closed
        }

        // Ensure overlay hidden if not mobile
        overlay.classList.add('hidden');
    }

    document.addEventListener('DOMContentLoaded', initializeSidebar);
    window.addEventListener('load', initializeSidebar);
    window.addEventListener('resize', initializeSidebar);

    // Populate sidebar with entries
    const links = {};
    const flatEntries = [];
    entries.forEach(entry => {
        const li = document.createElement('li');

        const button = document.createElement('button');
        button.className = "flex items-center justify-between w-full text-left text-gray-400 hover:text-blue-500 py-2 transition-colors font-medium hover:cursor-pointer";
        button.textContent = entry.title;

        li.appendChild(button);

        if (entry.subsections.length) {
            // Create transitionable arrow
            const arrow = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            arrow.setAttribute("class", "w-3 h-3 transition-transform duration-200 -rotate-90");
            arrow.setAttribute("viewBox", "0 0 10 6");
            arrow.setAttribute("fill", "none");
            arrow.innerHTML = `<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1l4 4 4-4"/>`;
            button.appendChild(arrow);

            const subUl = document.createElement('ul');
            subUl.className = "ml-4 space-y-2 hidden";

            entry.subsections.forEach(sub => {
                const subLi = document.createElement('li');
                const subLink = document.createElement('a');
                subLink.href = `#${entry.id}:${sub.id}`;
                subLink.textContent = sub.title;
                subLink.className = "block text-gray-400 hover:text-blue-500 text-sm";
                subLi.appendChild(subLink);
                subUl.appendChild(subLi);
                links[`${entry.id}:${sub.id}`] = subLink;
            });

            li.appendChild(subUl);

            button.addEventListener('click', () => {
                const isHidden = subUl.classList.contains('hidden');
                subUl.classList.toggle('hidden');

                // Toggle arrow rotation: closed (-rotate-90) <-> open (rotate-0)
                if (isHidden) {
                    arrow.classList.remove('-rotate-90');
                    arrow.classList.add('rotate-0');
                } else {
                    arrow.classList.remove('rotate-0');
                    arrow.classList.add('-rotate-90');
                }
            });
        } else {
            button.addEventListener('click', () => {
                window.location.hash = entry.id;
            });
        }

        sidebar.appendChild(li);

        links[entry.id] = button;
        if (entry.subsections.length > 0) entry.subsections.forEach(sub => {
            flatEntries.push({id: `${entry.id}:${sub.id}`, title: sub.title});
        });
        else flatEntries.push({id: entry.id, title: entry.title});
    });

    // Docs Hub link at the end
    const hubLink = document.getElementById('hub-link');
    hubLink.innerHTML = `
    <a href="index.html" class="flex items-center py-2 px-3 justify-center text-gray-400 hover:text-blue-500 font-medium">
        <svg class="w-3 h-3 mr-2 transition-transform duration-200 rotate-90" viewBox="0 0 10 6" fill="none">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1l4 4 4-4"/>
        </svg>
        Back to Bad Docs
    </a>
`;


    // Load an entry by ID
    function loadEntry(hash) {
        if (!hash) return;

        const [sectionId, subsectionId] = hash.split(':');
        const section = entries.find(e => e.id === sectionId);
        if (!section) return;

        let html = `<h1 class="text-4xl font-bold pb-8">${section.title}</h1>
                <hr class="border-slate-600 mb-6">
                ${section.content}`;

        if (subsectionId) {
            const sub = section.subsections.find(s => s.id === subsectionId);
            if (sub) html += `<h2 class="text-2xl font-bold mt-10 mb-3">${sub.title}</h2>${sub.content}`;
        }

        html += `<div id="bottom-nav" class="flex justify-center md:gap-4 fixed bottom-0 left-0 right-0 md:border-0 border-t md:bg-transparent border-slate-600 bg-slate-800/50 backdrop-blur-md p-1 rounded-lg md:p-3 md:static md:bg-transparent md:mt-8 md:mx-10 md:mb-0 pb-safe transition-opacity duration-500 ease-in-out">
    <button id="prevSection" class="flex-1 flex flex-col items-start min-w-0 md:border border-r border-slate-600 hover:border-blue-500 py-2 px-4 md:rounded-xl hover:cursor-pointer disabled:opacity-0">
        <span class="text-sm font-semibold">← Previous</span>
        <span id="prevId" class="text-blue-500 mt-1 truncate block max-w-full"></span>
    </button>
    <button id="nextSection" class="flex-1 flex flex-col items-end min-w-0 md:border border-l border-slate-600 hover:border-blue-500 py-2 px-4 md:rounded-xl hover:cursor-pointer disabled:opacity-0">
        <span class="text-sm font-semibold">Next →</span>
        <span id="nextId" class="text-blue-500 mt-1 truncate block max-w-full"></span>
    </button>
</div>`;

        content.innerHTML = html;

        // Highlight section
        Object.values(links).forEach(link => {
            link.classList.remove('text-blue-600', 'font-bold');
            link.classList.add('text-gray-400');
        });

        const activeLink = links[hash] || links[sectionId];
        if (activeLink) {
            activeLink.classList.add('text-blue-600', 'font-bold');
            activeLink.classList.remove('text-gray-400');
        }

        // Open parent section if subsection is active
        if (subsectionId) {
            const parentUl = activeLink.closest('ul');
            if (parentUl) {
                parentUl.classList.remove('hidden');

                // Make sure arrow points down when opened
                const parentButton = parentUl.previousElementSibling;
                const arrowSvg = parentButton.querySelector('svg');
                if (arrowSvg) {
                    arrowSvg.classList.remove('-rotate-90');
                    arrowSvg.classList.add('rotate-0');
                }
            }
        }

        const index = flatEntries.findIndex(e => e.id === hash);
        const prevBtn = document.getElementById('prevSection');
        const nextBtn = document.getElementById('nextSection');
        const prevIdSpan = document.getElementById('prevId');
        const nextIdSpan = document.getElementById('nextId');

        if (index > 0) {
            prevBtn.disabled = false;
            prevIdSpan.textContent = flatEntries[index - 1].title;
            prevBtn.onclick = () => window.location.hash = flatEntries[index - 1].id;
        } else {
            prevBtn.disabled = true;
            prevIdSpan.textContent = '';
        }

        if (index < flatEntries.length - 1) {
            nextBtn.disabled = false;
            nextIdSpan.textContent = flatEntries[index + 1].title;
            nextBtn.onclick = () => window.location.hash = flatEntries[index + 1].id;
        } else {
            nextBtn.disabled = true;
            nextIdSpan.textContent = '';
        }
    }

    // Handle Keybinds for switching pages
    document.addEventListener('keydown', (e) => {
        const hash = window.location.hash.substring(1);
        const index = flatEntries.findIndex(entry => entry.id === hash);
        if (index === -1) return;

        switch (e.key) {
            case "Enter":
            case "ArrowRight":
                if (index < flatEntries.length - 1) window.location.hash = flatEntries[index + 1].id;
                break;
            case "ArrowLeft":
            case "Backspace":
                if (index > 0) window.location.hash = flatEntries[index - 1].id;
                break;
        }
    });

    // Load entry when hash changes
    window.addEventListener('hashchange', () => loadEntry(window.location.hash.substring(1)));
    if (window.location.hash) loadEntry(window.location.hash.substring(1));
    if (overlay) overlay.addEventListener('click', closeSidebar);

    // Hide UI for readability
    const uiElements = [sidebarToggleWrapper, document.getElementById('bottom-nav')];
    let hideTimeout;

    function showUI() {
        uiElements.forEach(el => {
            if (!el) return;
            if (el.id === 'bottom-nav' && window.innerWidth >= 768) return;
            if (el) el.classList.remove('opacity-0', 'pointer-events-none', 'scale-75');
            if (el) el.classList.add('opacity-100', 'scale-100');
        });
    }

    function hideUI() {
        uiElements.forEach(el => {
            if (!el) return;
            if (el.id === 'bottom-nav' && window.innerWidth >= 768) return;
            if (el) el.classList.remove('opacity-100', 'scale-100');
            if (el) el.classList.add('opacity-0', 'pointer-events-none', 'scale-75');
        });
    }

    function resetHideTimer() {
        const sidebarClosed = (window.innerWidth < 768)
            ? sidebarEl.classList.contains('-translate-y-full')
            : sidebarEl.classList.contains('-translate-x-full');
        if (!sidebarClosed) return;

        showUI();
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
            hideUI();
        }, 3000); // 3 seconds of inactivity
    }

    window.addEventListener('mousemove', resetHideTimer);
    window.addEventListener('touchstart', resetHideTimer);
    window.addEventListener('scroll', resetHideTimer);

    resetHideTimer();
</script>

</body>
</html>
